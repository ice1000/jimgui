environment:
  JAVA_HOME: C:\Program Files\Java\jdk1.8.0
  CXX: C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin\g++.exe
  CC:  C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin\gcc.exe
  CMAKE_CXX_COMPILER: C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin\g++.exe
  CMAKE_CC_COMPILER:  C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin\gcc.exe
  PATH: C:\projects\deps\wget;C:\projects\deps\glfw-3.2.1;C:\projects\deps\pkg-config\bin\;%PATH%
#

install:
  # CMake refuses to generate MinGW Makefiles if sh.exe is in the Path
  - ps: Get-Command sh.exe -All | Remove-Item

  ############################################################################
  # All external dependencies are installed in C:\projects\deps
  ############################################################################
  - mkdir C:\projects\deps
  - cd C:\projects\deps

  ############################################################################
  # Install PkgConfig
  ############################################################################
  - set PKG_CONFIG_URL="http://ftp.gnome.org/pub/gnome/binaries/win32/dependencies/pkg-config_0.26-1_win32.zip"
  - appveyor DownloadFile %PKG_CONFIG_URL% -FileName pkg-config_win32.zip
  - 7z x -y pkg-config_win32.zip -opkg-config

  ############################################################################
  # Install wget
  ############################################################################
  - set WGET_URL="https://eternallybored.org/misc/wget/releases/wget-1.19.4-win64.zip"
  - appveyor DownloadFile %WGET_URL% -FileName wget.zip
  - 7z x wget.zip -owget

#  ############################################################################
#  # Install GLFW3
#  ############################################################################
#  - set GLFW_URL="https://github.com/glfw/glfw/archive/3.2.1.zip"
#  - appveyor DownloadFile %GLFW_URL% -FileName glfw-3.2.1.zip
#  - unzip glfw-3.2.1.zip
#  - cd glfw-3.2.1
#  - cmake -DCMAKE_BUILD_TYPE= -G "CodeBlocks - MinGW Makefiles" \
#          -DBUILD_SHARED_LIBS=ON \
#          -DGLFW_BUILD_EXAMPLES=OFF \
#          -DGLFW_BUILD_TESTS=OFF \
#          -DGLFW_BUILD_DOCS=OFF \
#          .
#  - mingw32-make.exe
#  - mingw32-make.exe install
#  - cd ..

  - refreshenv

cache:
  - C:\Users\appveyor\.gradle
#

build_script:
  - cd C:\projects\jimgui\
  - echo %CMAKE_CC_COMPILER%
  - echo %CMAKE_CXX_COMPILER%
  - gradlew genBindings javah --info
  - mkdir jni\cmake-build-debug
  - mkdir res
  - mkdir res\native
  - cd jni

  - wget --version

  - pre
  - cd cmake-build-debug
  - cmake -DCMAKE_BUILD_TYPE= -G "CodeBlocks - MinGW Makefiles" \
          -DPKG_CONFIG_EXECUTABLE="C:\pkg-config\bin\pkg-config.exe" \
          -Dglfw3_DIR="C:\Program Files (x86)\GLFW\lib\cmake\glfw3" \
         ..
  - mingw32-make.exe
  - copy *.dll ..\..\res\native\
  - cd ..\..
  - gradlew jar --info
  - gradlew test --info
#

before_build:
  - set Path=C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin;%Path%
#

artifacts:
  - path: 'build\libs\*.jar'
    name: jimgui
#

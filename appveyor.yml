environment:
  JAVA_HOME: C:\Program Files\Java\jdk1.8.0
  CXX: C:\Program Files\LLVM\bin\clang-cl.exe
  CC:  C:\Program Files\LLVM\bin\clang-cl.exe
  CMAKE_CXX_COMPILER: C:\Program Files\LLVM\bin\clang-cl.exe
  CMAKE_CC_COMPILER:  C:\Program Files\LLVM\bin\clang-cl.exe
#

install:
  # CMake refuses to generate MinGW Makefiles if sh.exe is in the Path
  - ps: Get-Command sh.exe -All | Remove-Item

  ############################################################################
  # All external dependencies are installed in C:\projects\deps
  ############################################################################
  - mkdir C:\projects\deps
  - cd C:\projects\deps

  ############################################################################
  # Install a recent CMake
  ############################################################################
  - set CMAKE_URL="https://cmake.org/files/v3.10/cmake-3.10.0-win64-x64.zip"
  - appveyor DownloadFile %CMAKE_URL% -FileName cmake.zip
  - 7z x cmake.zip -oC:\projects\deps > nul
  - move C:\projects\deps\cmake-* C:\projects\deps\cmake # Move to a version-agnostic directory
  - set PATH=C:\projects\deps\cmake\bin;%PATH%
  - cmake --version

  ############################################################################
  # Install wget
  ############################################################################
  - set WGET_URL="https://eternallybored.org/misc/wget/releases/wget-1.19.4-win64.zip"
  - appveyor DownloadFile %WGET_URL% -FileName wget.zip
  - 7z x wget.zip -oC:\projects\deps > nul
  - set PATH=C:\projects\deps\wget;%PATH%
  - wget --version
  - cd jni

  - set GITHUB=https://raw.githubusercontent.com/ocornut/imgui/master
  - set COV_GITHUB=https://raw.githubusercontent.com/covscript/covscript-imgui/master
  - set ICE_GITHUB=https://raw.githubusercontent.com/ice1000/algo4j/master
  - set TO_IMGUI=--directory-prefix=imgui
  - set TO_IMPL=--directory-prefix=impl

  - mkdir imgui
  - mkdir impl
  - mkdir impl\GL

  - wget %GITHUB%/imgui.cpp %TO_IMGUI%
  - wget %GITHUB%/imgui.h %TO_IMGUI%
  - wget %GITHUB%/imgui_draw.cpp %TO_IMGUI%
  - wget %GITHUB%/imgui_internal.h %TO_IMGUI%
  - wget %GITHUB%/imconfig.h %TO_IMGUI%
  - wget %GITHUB%/stb_rect_pack.h %TO_IMGUI%
  - wget %GITHUB%/stb_textedit.h %TO_IMGUI%
  - wget %GITHUB%/stb_truetype.h %TO_IMGUI%
  - wget %GITHUB%/examples/opengl3_example/imgui_impl_glfw_gl3.h %TO_IMPL%
  - wget %GITHUB%/examples/opengl3_example/imgui_impl_glfw_gl3.cpp %TO_IMPL%
  - wget %COV_GITHUB%/include/GL/gl3w.h %TO_IMPL%/GL
  - wget %COV_GITHUB%/include/GL/glcorearb.h %TO_IMPL%/GL
  - wget %COV_GITHUB%/src/gl3w.c %TO_IMPL%
  - cd ..

  ############################################################################
  # Setup the path to Clang-cl
  ############################################################################
  - set PATH="C:\Program Files\LLVM\bin";%PATH%
  - clang-cl -v
#  - refreshenv

cache:
  - C:\Users\appveyor\.gradle
#

build_script:
  - cd C:\projects\jimgui\
  - echo %CMAKE_CC_COMPILER%
  - echo %CMAKE_CXX_COMPILER%
  - gradlew genBindings javah --info
  - mkdir jni\cmake-build-debug
  - mkdir res
  - mkdir res\native
  - cd jni
  - cd cmake-build-debug
  - cmake -DCMAKE_BUILD_TYPE= -G "CodeBlocks - MinGW Makefiles" ..
  - mingw32-make.exe
  - copy *.dll ..\..\res\native\
  - cd ..\..
  - gradlew jar --info
  - gradlew test --info
#

before_build:
  - set Path=C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin;%Path%
#

artifacts:
  - path: 'build\libs\*.jar'
    name: jimgui
#
